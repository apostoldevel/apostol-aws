# Система

**Система** предоставляет доступ к методам **API** с помощью собственного HTTP-сервера [Апостол](https://github.com/ufocomp/apostol). 

Система состоит из двух абстрактных частей **платформы** и **конфигурации**. 
* **Платформа** - это технологии и протоколы (встроенные службы и модули) на которых строится система.
* **Конфигурация** - это бизнес логика проекта.

**Конфигурация** базируется на API платформы и дополняет её функциями необходимыми для решения задач проекта.

## Абстракция представления данных в системе

Данные в системе представлены в виде объектов и имеют слой абстракции описание которого изложено ниже.

### Слой абстракции
* Это логическая модель и способ хранения данных в СУБД. Суть которой заключается в том, что единицей хранения данных в системе является не запись в конкретной таблице, а **объект** или по другому - **документ**.     

#### Определение объекта 
* **_Объект_** - это физическая или логическая сущность, которую можно представить в виде единого целого. Клиент - это объект, договор - это объект, лицевой счёт, на котором отражается финансовая информация клиента это тоже объект и даже адрес клиента также можно представить в виде объекта.

* _Объект_ обладает рядом характеристик, таких как: «**_класс_**», «**_тип_**» и «**_состояние_**». Объект в системе разделён на два базовых класса - **_документ_** и **_справочник_**.

* _Документ_ имеет поле `area` (зона). **Зона** ограничивает область видимости документа. **_Справочник_** не обладает таким свойством.

* Над _объектом_ можно совершать «_действия_», которые вызывают в системе «_события_», которые, в свою очередь, могут привести к изменению «_состояния_» объекта. Всё это является механизмом работы _документооборота_.

#### Документооборот
Это последовательность совершаемых над объектом действий, приводящих к возникновению событий, способных повлиять на состояние объекта. Последовательность переходов из одного состояния объекта в другое называется «`жизненным циклом`».

#### Сущность
* Характеризует физический или логический смысл _объекта_.

**Сущность** задаётся разработчиком системы и в отличие от других характеристик объекта не может быть изменена пользователем системы. На данный момент системе определены следующие сущности:
- `object` Объект;
- `document` Документ;
- `reference` Справочник;
- `address` Адрес;
- `client` Клиент;
- `calendar` Календарь;

#### Класс
* Это условное разделение объекта по тем или иным признакам.

Класс объекта характеризует сам объект. Класс объекта в отличие от сущности может быть создан пользователем системы по его собственному усмотрению.

Классы объекта создаются в виде дерева, т.е. имеют иерархическую структуру. Для каждого класса объекта настраиваются своя собственная схема документооборота, т.е. формируется список, в каких именно состояниях может находиться объект. Для каждого состояния создается список доступных действий, для каждого действия создается список событий и настраивается таблица переходов из одного состояния в другое т.е. «_жизненный цикл_».

Класс объекта может быть _абстрактным_, создать документ с абстрактным классом объекта невозможно.

##### Дерево классов объекта
- `object` Объект (абстрактный);
  - `document` Документ (абстрактный);
    - `address` Адрес;
    - `client` Клиент;
  - `reference` Справочник (абстрактный);
    - `calendar` Календарь рабочих дней;

#### Состояния
* Каждый объект в системе находиться в том или ином состоянии. _Состояние_ объекта привязывается к классу объекта. Список состояний для каждого класса объектов индивидуален и может быть настроен пользователем по своему собственному усмотрению.

##### Тип состояния объекта
В системе есть четыре типа состояния объекта:
- `created` Создан;
- `enabled` Включен;
- `disabled` Отключен;
- `deleted` Удалён.

##### Состояние объекта
* Это промежуточное звено в цепи документооборота системы.

Каждому из типов состояния должно соответствовать как минимум одно состояние объекта из чего следует, что каждый объект может находиться как минимум в четырех состояниях. Типы состояний объекта недоступны для изменения пользователю системы, но на базе этих типов пользователь может создать сколько угодно собственных состояний объекта. Первоначальное состояние любого нового объекта в системе это – «Создан». Для каждого состояния объекта задается определенный список действий. Переход из одного состояния объекта в другое происходить только при совершении над ним определенного действия.

#### Действие
* Действие, совершаемое над объектом также, как и состояния объекта задается для каждого класса объекта и формируется из заданного разработчиком системы списка..

На основе заданных действий, путем добавления новых или переопределения уже имеющихся, для каждого класса, пользователь системы может сформировать свой собственный список **_методов_** и **_событий_**.
 
#### Метод (динамический)
* Это визуальная часть в цепи документооборота системы.

Именно методы отображаются в интерфейсе пользователя в виде кнопок и элементов меню.

#### Событие
* Это реакция на совершаемое над объектом действие.

К каждому событию объекта привязывается написанные на языке PL/pgSQL процедуры. При возникновении события ядро системы начинает поочередно выполнять код в привязанных к событию процедурах. Выполняемый код может быть абсолютно любым, и иметь разную смысловую нагрузку будь то проверка объекта на переход из одного состояния в другое или информирование пользователя о неправильно заполненных полях.

Переход объекта из одного состояния в другое, согласно настроенного документооборота, происходит при вызове функции `ChangeObjectState()`.

Для того, чтобы совершить действие над объектом (_включить_, _выключить_, _удалить_, _уничтожить_) необходимо вызвать функцию `ExecuteObjectAction(pObject, pAction)`.

# API

## Общая информация
 * Базовая конечная точка (endpoint): [localhost:8080](http://localhost:8080)
 * Все конечные точки возвращают `JSON-объект`
 * Все поля, относящиеся ко времени и меткам времени, указаны в **миллисекундах**. 

## HTTP коды возврата
 * HTTP `4XX` коды возврата применимы для некорректных запросов - проблема на стороне клиента.
 * HTTP `5XX` коды возврата используются для внутренних ошибок - проблема на стороне сервера. Важно **НЕ** рассматривать это как операцию сбоя. Статус выполнения **НЕИЗВЕСТЕН** и может быть успешным.
 
## Коды ошибок
 * Любая конечная точка может вернуть ошибку.
  
**Пример ответа:**
```json
{
  "error": {
    "code": 404,
    "message": "Not Found"
  }
}
```

## Общая информация о конечных точках
 * Для `GET` конечных точек параметры должны быть отправлены в виде `строки запроса (query string)` .
 * Для `POST` конечных точек, некоторые параметры могут быть отправлены в виде `строки запроса (query string)`, а некоторые в виде `тела запроса (request body)`:
 * При отправке параметров в виде `тела запроса` допустимы следующие типы контента:
    * `application/x-www-form-urlencoded` для `query string`;
    * `multipart/form-data` для `HTML-форм`;
    * `application/json` для `JSON`.
 * Параметры могут быть отправлены в любом порядке.

## Доступ к API

Доступ к API возможен только при наличии маркера доступа или цифровой подписи методом HMAC-SHA256. 

#### Маркер доступа

**Маркера доступа** (`access_token`) **ДОЛЖЕН** присутствовать в HTTP заголовке `Authorization` каждого запроса.
 
Формат:
~~~
Authorization: Bearer <access_token>
~~~

**Маркера доступа** - это `JSON Web Token` [RFC 7519](https://tools.ietf.org/html/rfc7519). 

Выдается он **сервером авторизации**, роль которого выполняет сама же система.

Пример запроса:
* **http request:**
```http request
GET /api/v1/whoami HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiIDogImFjY291bnRzLnNoaXAtc2FmZXR5LnJ1IiwgImF1ZCIgOiAid2ViLXNoaXAtc2FmZXR5LnJ1IiwgInN1YiIgOiAiZGZlMDViNzhhNzZiNmFkOGUwZmNiZWYyNzA2NzE3OTNiODZhYTg0OCIsICJpYXQiIDogMTU5MzUzMjExMCwgImV4cCIgOiAxNTkzNTM1NzEwfQ.NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
````

#### Цифровая подпись методом HMAC-SHA256

Вместо HTTP заголовка `Authorization` можно использовать подпись. 

Для передачи данных авторизации в виде подписи используются следующие HTTP заголовки:
  * `Session` - ключ сессии;
  * `Nonce` - данное время в миллисекундах;
  * `Signature` - подпись.

**Примеры:**

**Пример создания подписи на JavaScript (без данных в теле сообщения):**
~~~javascript
// CryptoJS - Standard JavaScript cryptography library

const body = null;

const Session = localStorage.getItem('Session'); // efa885ebde1baa991a3c798fc1141f6bec92fc90
const Secret = localStorage.getItem('Secret'); // y2WYJRE9f13g6qwFOEOe0rGM/ISlGFEEesUpQadHNd/aJL+ExKRj5E6OSQ9TuJRC

const Path = '/whoami';
const Nonce = (Date.now() * 1000).toString(); // 1589998352818000
const Body = JSON.stringify(body); // if body === null then Body = "null" <-- string  

const sigData = `${Path}${Nonce}${Body}`; // /whoami1589998352818000null

const Signature = CryptoJS.HmacSHA256(sigData, Secret).toString(); // 91609292e250fc30c48c2ad387d1121c703853fa88ce027e6ba0efe1fcb50ba1

let headers = new Headers();

headers.append('Session', Session);
headers.append('Nonce', Nonce);
headers.append('Signature', Signature);
headers.append('Content-Type', 'application/json');

const init = {
    method: 'POST',
    headers: headers,
    body: Body,
    mode: "cors"
};

const apiPath = `/api/v1${Path}`;

fetch(apiPath, init)
    .then((response) => {
        return response.json();
    })
    .then((json) => {
        console.log(json);
    })
    .catch((e) => {
        console.log(e.message);
});
~~~
* **openssl command:**
```shell script
echo -n "/whoami1589998352818000null" | \
openssl sha256 -hmac "y2WYJRE9f13g6qwFOEOe0rGM/ISlGFEEesUpQadHNd/aJL+ExKRj5E6OSQ9TuJRC"
(stdin)= 91609292e250fc30c48c2ad387d1121c703853fa88ce027e6ba0efe1fcb50ba1
```
* **curl command:**
```curl
curl -X POST \
     -H "Session: efa885ebde1baa991a3c798fc1141f6bec92fc90" \
     -H "Nonce: 1589998352818000" \
     -H "Signature: 91609292e250fc30c48c2ad387d1121c703853fa88ce027e6ba0efe1fcb50ba1" \
     http://localhost:8080/api/v1/whoami
````     
* **http request:**
```http request
POST /api/v1/whoami HTTP/1.1
Host: localhost:8080
Session: efa885ebde1baa991a3c798fc1141f6bec92fc90
Nonce: 1589998352818000
Signature: 91609292e250fc30c48c2ad387d1121c703853fa88ce027e6ba0efe1fcb50ba1
````
  
**Пример создания подписи на JavaScript (с данными в теле сообщения):**
~~~javascript
// CryptoJS - Standard JavaScript cryptography library

const body = {
  classcode : 'client',
  statecode : 'enabled',
  actioncode: 'invite'
};

const Session = localStorage.getItem('Session'); // efa885ebde1baa991a3c798fc1141f6bec92fc90
const Secret = localStorage.getItem('Secret'); // y2WYJRE9f13g6qwFOEOe0rGM/ISlGFEEesUpQadHNd/aJL+ExKRj5E6OSQ9TuJRC

const Path = '/method/get';
const Nonce = (Date.now() * 1000).toString(); // 1589998352902000
const Body = JSON.stringify(body); // <-- JSON string  

const sigData = `${Path}${Nonce}${Body}`; // /method/get1589998352902000{"classcode":"client","statecode":"enabled","actioncode":"invite"}

const Signature = CryptoJS.HmacSHA256(sigData, Secret).toString(); // 2b2bf5188ea40dfe8207efec56956b6170bdbc2f0ab0bffd8b50acd60979b09b

let headers = new Headers();

headers.append('Session', Session);
headers.append('Nonce', Nonce);
headers.append('Signature', Signature);
headers.append('Content-Type', 'application/json');

const init = {
    method: 'POST',
    headers: headers,
    body: Body,
    mode: "cors"
};

const apiPath = `/api/v1${Path}`;

fetch(apiPath, init)
    .then((response) => {
        return response.json();
    })
    .then((json) => {
        console.log(json);
    })
    .catch((e) => {
        console.log(e.message);
});
~~~
* **openssl command:**
```shell script
echo -n "/method/get1589998352902000{\"classcode\":\"client\",\"statecode\":\"enabled\",\"actioncode\":\"invite\"}" | \
openssl sha256 -hmac "y2WYJRE9f13g6qwFOEOe0rGM/ISlGFEEesUpQadHNd/aJL+ExKRj5E6OSQ9TuJRC"
(stdin)= 2b2bf5188ea40dfe8207efec56956b6170bdbc2f0ab0bffd8b50acd60979b09b
````
* **curl command:**
```curl
curl -X POST \
     -H "Session: efa885ebde1baa991a3c798fc1141f6bec92fc90" \
     -H "Nonce: 1589998352902000" \
     -H "Signature: 2b2bf5188ea40dfe8207efec56956b6170bdbc2f0ab0bffd8b50acd60979b09b" \
     -d "{\"classcode\":\"client\",\"statecode\":\"enabled\",\"actioncode\":\"invite\"}" \
     http://localhost:8080/api/v1/method/get
````
* **http request:**
```http request
POST /api/v1/method/get HTTP/1.1
Host: localhost:8080
Session: efa885ebde1baa991a3c798fc1141f6bec92fc90
Nonce: 1589998352902000
Signature: 2b2bf5188ea40dfe8207efec56956b6170bdbc2f0ab0bffd8b50acd60979b09b

{"classcode":"client","statecode":"enabled","actioncode":"invite"}
````

## Сервер авторизации

Встроенный в систему сервер авторизации разработан на основе спецификации **OAuth 2.0** [RFC 6749](https://tools.ietf.org/html/rfc6749) и расширении **OpenID Connect**.
 
### Аутентификация и авторизация

#### Использование протокола OAuth 2.0 для авторизации пользователя

Протокол определяет четыре роли:

 * Владелец ресурса (`resource owner`) – Пользователь системы (физическое лицо);
 * Клиент (`client`) – Приложение, которое запрашивает доступ к защищаемому ресурсу от имени его владельца;
 * Сервер авторизации (`authorization server`) – сервер, который выпускает для клиента маркеры идентификации с разрешениями от владельца ресурса, а также маркеры доступа, позволяющие получать доступ к данным;
 * Поставщик ресурса (`resource server`) – сервер, обеспечивающий доступ к защищаемому ресурсу на основе проверки маркеров идентификации и маркеров доступа (например, к идентификационным данным пользователя).

В рамках данной системы `authorization server` и `resource server` - это один и тот же сервер.

Для взаимодействия `Клиента` с `Сервером` необходимо получить идентификатор (`client_id`) и секрет (`client_secret`).

Взаимодействие происходит через `RESTful` API описанное в спецификации [RFC 6749](https://tools.ietf.org/html/rfc6749).

#### Использование OpenID Connect для аутентификации пользователя

В общем виде схема аутентификация с использованием OpenID Connect выглядит следующим образом:

 * **Клиент** (`client`) готовит запрос на аутентификацию пользователя с необходимыми параметрами;
 * **Клиент** (`client`) отправляет `GET` запрос на аутентификацию в адрес сервера авторизации;
 * **Сервер авторизации** (`authorization server`) аутентифицирует пользователя (пользователь вводит логин и пароль);
 * **Сервер авторизации** (`authorization server`) получает согласие пользователя на проведение аутентификации в данной системе;
 * **Сервер авторизации** (`authorization server`) перенаправляет пользователя обратно **Клиенту** и передает код авторизации;
 * **Клиент** (`client`) отправляет `POST` запрос с использованием кода авторизации на получения маркера идентификации;
 * **Клиент** (`client`) получает ответ, содержащий необходимый маркер идентификации (меняет код авторизации на маркер доступа);
 * **Клиент** (`client`) проводит проверку маркера идентификации и извлекает из маркера идентификатор пользователя.

Далее детально будут рассмотрены формируемые **Клиентом** запросы и ответы от **Сервера авторизации**.

#### Конечные точки сервера авторизации:

Для авторизации:
```http request
GET /oauth2/authorize
```
Для получения маркера доступа:
```http request
POST /oauth2/token
```
#### Разрешение на авторизацию

Протокол **OAuth 2** определяет четыре разных типа **разрешения на авторизацию**, каждый из которых полезен в определённых ситуациях:

 1. **Код авторизации** (`Authorization Code`): используется с серверными приложениями (server-side applications).
 1. **Неявный** (`Implicit`): используется мобильными или веб-приложениями (JavaScript), приложениями работающими на устройстве пользователя.
 1. **Учётные данные владельца ресурса** (`Resource Owner Password Credentials`): используются доверенными приложениями, например приложениями, которые являются частью самого сервера.
 1. **Учётные данные клиента** (`Client Credentials`): используются при доступе клиента (приложения) к API без авторизации пользователя.

#### Типы разрешения на авторизацию

##### Код авторизации

* Код авторизации является одним из наиболее распространённых типов разрешения на авторизацию, поскольку он хорошо подходит для серверных приложений, где исходный код приложения и секрет клиента не доступны посторонним. Процесс в данном случае строится на перенаправлении (redirection), что означает, что приложение должно быть в состоянии взаимодействовать с пользовательским агентом (user-agent), например, веб-браузером, и получать коды авторизации API, перенаправляемые через пользовательский агент.

**Параметры запроса:**

Поле | Значение | Описание
------------ | :------------: | ------------
client_id | `client_id` | **Обязательный**. Идентификатор клиента (приложения).
redirect_uri | `redirect_uri` | **Обязательный**. URI, на который сервер авторизации перенаправит агента пользователя (браузер) и код авторизации.
response_type | code | **Обязательный**. Указывает на то, что приложение запрашивает доступ с помощью кода авторизации.
scope | `scope` | **Рекомендуемый**. Список областей, разделенных пробелами, которые определяют ресурсы, к которым ваше приложение может получить доступ от имени пользователя.
access_type | `access_type` | **Рекомендуемый**. Указывает, может ли ваше приложение обновлять маркеры доступа, когда пользователь отсутствует в браузере. Допустимые значения параметров: online (по умолчанию) и offline. 
state | `state` | **Рекомендуемый**. Набор случайных символов которые будут возвращены сервером клиенту (используется для защиты от повторных запросов).

**Пример зпроса:**
```http request
GET /oauth2/authorize?client_id=web-service.ru&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foauth2%2Fcode&scope=api&response_type=code&access_type=online&state=c2FmZXR HTTP/1.1
Host: localhost:8080
```

```
http://localhost:8080/oauth2/authorize?
  client_id=web-service.ru&
  redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foauth2%2Fcode&
  response_type=code&
  access_type=online&
  scope=api&
  state=c2FmZXR
```

Если в ходе аутентификации не возникло ошибок, то сервер авторизации перенаправит пользователя по ссылке, указанной в `redirect_uri`, а также вернёт два обязательных параметра:
 * code – Код авторизации;
 * state – Значение параметра `state`, которое было получено в запросе на аутентификацию;

**Клиент** должен провести сравнение отправленного и полученного параметра `state`.

**Ответ с кодом авторизации:**
```
http://localhost:8080/oauth2/code?code=b%2F8NpjbB4eLaukGr68tE7maTCeBISO%2FC7hWxKGuKb8I4Ysc7uw8a2MRUMWnO3Nzt
``` 
* Обратите внимание, на то что код (`b/8NpjbB4eLaukGr68tE7maTCeBISO/C7hWxKGuKb8I4Ysc7uw8a2MRUMWnO3Nzt`) закодирован алгоритмом [URL encode](https://www.urlencoder.org/) и его нужно будет декодировать алгоритмом [URL Decode](https://www.urldecoder.org/). 

Если в ходе аутентификации возникла ошибка, то сервер авторизации перенаправит пользователя по ссылке, указанной в `redirect_uri` с информацией об ошибке:
```
http://localhost:8080/oauth2/code?code=403&error=access_denied&error_description=Access%20denied.
``` 
 
Для обмена кода авторизации на маркер доступа **Клиент** должен сформировать запрос методом `POST`.

**Параметры запроса**: 

Поле | Значение | Описание
------------ | :------------: | ------------
client_id | `client_id` | **Обязательный**. Идентификатор клиента.
client_secret | `client_secret` | **Обязательный**. Секрет клиента.
grant_type | authorization_code | **Обязательный**. Как определено в [спецификации](https://tools.ietf.org/html/rfc6749#section-4.1.3) OAuth 2.0, это поле должно содержать значение authorization_code.
code | `code` | **Обязательный**. Код авторизации, возвращенный из первоначального запроса.
redirect_uri | `redirect_uri` | **Обязательный**. URI переадресации (должен совпадать с `redirect_uri` из первоначального запроса). 

* Согласно [спецификации](https://tools.ietf.org/html/rfc6749#section-2.3.1) OAuth 2.0, параметры авторизации клиента (`client_id` и `client_secret`) могут быть переданы как в теле запроса так и в HTTP заголовке `Authorization` (HTTP Basic authentication).

```
Authorization: Basic d2ViLXNlcnZpY2UucnU6Y2xpZW50IHNlY3JldA==   
```

В ответ на запрос сервер авторизации, вернет объект JSON, который содержит маркер краткосрочного доступа и маркер обновления.

**Ответ содержит следующие поля:**

Поле | Тип | Описание
------------ | ------------ | ------------
access_token | STRING | Маркер краткосрочного доступа (сроком действия 1 час).
expires_in | INTEGER | Оставшееся время жизни маркера доступа в секундах.
token_type | STRING | Тип возвращаемого маркера. Значение всегда будет Bearer.
session | STRING | Идентификатор сессии пользователя.
refresh_token | STRING | * Маркер который вы можете использовать для получения нового маркер доступа.
id_token | STRING | * Маркер пользователя.

* Обратите внимание, что маркер обновления возвращается только в том случае, если ваше приложение в первоначальном запросе к серверу авторизации, установило в `access_type` значение: offline.
* Обратите внимание, что маркер пользователя возвращается только в том случае, если ваше приложение в первоначальном запросе к серверу авторизации, установило в `scope` одно из значений: openid, profile или email.

**Пример зпроса:**

```http request
POST http://localhost:8080/oauth2/token
Content-Type: application/x-www-form-urlencoded
 
client_id=web-service.ru&
client_secret=<client_secret>&
grant_type=authorization_code&
code=b%2F8NpjbB4eLaukGr68tE7maTCeBISO%2FC7hWxKGuKb8I4Ysc7uw8a2MRUMWnO3Nzt&
redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foauth2%2Fcode
```
###### * Хоть это и не определено спецификацией, но сервер авторизации примет запрос и в формате JSON (Content-Type: `application/json`) 

**Пример ответа**:

```json
{
  "access_token" : "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiIDogImFjY291bnRzLnNoaXAtc2FmZXR5LnJ1IiwgImF1ZCIgOiAid2ViLXNoaXAtc2FmZXR5LnJ1IiwgInN1YiIgOiAiZGZlMDViNzhhNzZiNmFkOGUwZmNiZWYyNzA2NzE3OTNiODZhYTg0OCIsICJpYXQiIDogMTU5MzUzMjExMCwgImV4cCIgOiAxNTkzNTM1NzEwfQ.NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg",
  "token_type" : "Bearer",
  "expires_in" : 3600,
  "session" : "dfe05b78a76b6ad8e0fcbef270671793b86aa848"
}
```

#### Неявный

* Неявный тип разрешения на авторизацию используется мобильными и веб-приложениями (приложениями, которые работают в веб-браузере - JavaScript), где конфиденциальность секрета клиента не может быть гарантирована. Неявный тип разрешения также основан на перенаправлении пользовательского агента, при этом маркер доступа передаётся пользовательскому агенту для дальнейшей передачи приложению. Это, в свою очередь, делает маркер доступным пользователю и другим приложениям на устройстве пользователя. Также при этом типе разрешения на авторизацию не осуществляется аутентификация подлинности приложения, а сам процесс полагается на URI перенаправления (зарегистрированном ранее в сервере авторизации).

* Неявный тип разрешения на авторизацию не поддерживает маркеры обновления (`refresh_token`) и маркера пользователя (`id_token`).

**Параметры запроса:**

Поле | Значение | Описание
------------ | :------------: | ------------
client_id | `client_id` | **Обязательный**. Идентификатор клиента (приложения).
redirect_uri | `redirect_uri` | **Обязательный**. URI, на который сервер авторизации перенаправит агента пользователя (браузер) и маркер доступа.
response_type | token | **Обязательный**. Приложения JavaScript должны установить значение параметра в token. Это значение указывает серверу авторизации возвращать маркер доступа в виде пары name = value в идентификаторе фрагмента URI (#), на который перенаправляется пользователь после завершения процесса авторизации.
scope | `scope` | **Рекомендуемый**. Список областей, разделенных пробелами, которые определяют ресурсы, к которым ваше приложение может получить доступ от имени пользователя.
state | `state` | **Рекомендуемый**. Набор случайных символов которые будут возвращены сервером клиенту (используется для защиты от повторных запросов).

**Пример зпроса:**
```http request
GET /oauth2/authorize?client_id=web-service.ru&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foauth2%2Fcallback&scope=api&response_type=token&state=c2FmZXR HTTP/1.1
Host: localhost:8080
```

```
http://localhost:8080/oauth2/authorize?
  client_id=web-service.ru&
  redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foauth2%2Fcallback&
  response_type=token&
  scope=api&
  state=c2FmZXR
```

Маркер доступа или сообщение об ошибке возвращаются во фрагменте хэша URI перенаправления, как показано ниже:

**Ответ с маркером доступа:**
```
http://localhost:8080/callback#token_type=Bearer&expires_in=3600&session=dfe05b78a76b6ad8e0fcbef270671793b86aa848&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiIDogImFjY291bnRzLnNoaXAtc2FmZXR5LnJ1IiwgImF1ZCIgOiAid2ViLXNoaXAtc2FmZXR5LnJ1IiwgInN1YiIgOiAiZGZlMDViNzhhNzZiNmFkOGUwZmNiZWYyNzA2NzE3OTNiODZhYTg0OCIsICJpYXQiIDogMTU5MzUzMjExMCwgImV4cCIgOiAxNTkzNTM1NzEwfQ.NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
```
* В дополнение к параметру `access_token` строка фрагмента также содержит параметр `token_type`, который всегда имеет значение Bearer, и параметр `expires_in`, который указывает время жизни маркера в секундах. Если параметр `state` был указан в запросе маркера доступа, его значение также включается в ответ.

* URI перенаправления, в данном случае это `http://localhost:8080/callback/index.html` должен указывать на веб-страницу, которая содержит скрипт для извлечения маркера доступа из URI перенаправления. 

**Ответ с ошибкой:**
```
http://localhost:8080/callback#code=403&error=access_denied&error_description=Access%20denied.
```

###### Сервер авторизации поддерживает гибридный режим типов разрешения. Если в параметре `response_type` указать, через пробел, оба значения `code token`, то сервер авторизации вернет в одном запросе и код авторизации и маркер доступа.

#### Учётные данные владельца ресурса

* При этом типе разрешения на авторизацию пользователь предоставляет приложению напрямую свои учётные данные (имя пользователя и пароль). Приложение, в свою очередь, использует полученные учётные данные пользователя для получения маркера доступа от сервера авторизации. Этот тип разрешения на авторизацию должен использоваться только в том случае, когда другие варианты не доступны. Кроме того, этот тип разрешения стоит использовать только в случае, когда приложение пользуется доверием пользователя (например, является частью самой системы).

После того, как пользователь передаст свои учётные данные приложению, приложение запросит маркер доступа у авторизационного сервера методом `POST`.
 
**Параметры запроса:**

Поле | Значение | Описание
------------ | :------------: | ------------
client_id | `client_id` | **Обязательный**. Идентификатор клиента.
client_secret | `client_secret` | **Обязательный**. Секрет клиента.
grant_type | password | **Обязательный**. Как определено в [спецификации](https://tools.ietf.org/html/rfc6749#section-4.3.1) OAuth 2.0, это поле должно содержать значение password.
username | `username` | **Вариативный**. Логин пользователя. Игнорируется если указано значение в поле secret. 
password | `password` | **Вариативный**. Пароль пользователя. Игнорируется если указано значение в поле secret.
secret | `secret` | **Вариативный**. Секретный код. Если значение указано то поля username и password заполнять не нужно.
scope | `scope` | **Рекомендуемый**. Список областей, разделенных пробелами, которые определяют ресурсы, к которым ваше приложение может получить доступ от имени пользователя.

* Согласно [спецификации](https://tools.ietf.org/html/rfc6749#section-2.3.1) OAuth 2.0, параметры авторизации клиента (`client_id` и `client_secret`) могут быть переданы как в теле запроса так и в HTTP заголовке `Authorization` (HTTP Basic authentication).

```
Authorization: Basic d2ViLXNlcnZpY2UucnU6Y2xpZW50IHNlY3JldA==   
```

В ответ на запрос сервер авторизации, вернет объект JSON, который содержит маркер краткосрочного доступа и маркер обновления.

**Ответ содержит следующие поля:**

Поле | Тип | Описание
------------ | ------------ | ------------
access_token | STRING | Маркер краткосрочного доступа (сроком действия 1 час).
expires_in | INTEGER | Оставшееся время жизни маркера доступа в секундах.
token_type | STRING | Тип возвращаемого маркера. Значение всегда будет Bearer.
session | STRING | Идентификатор сессии пользователя.
refresh_token | STRING | Маркер который вы можете использовать для получения нового маркер доступа.
id_token | STRING | * Маркер пользователя.

* Обратите внимание, что маркер пользователя возвращается только в том случае, если ваше приложение в запросе к серверу авторизации, установило в `scope` одно из значений: openid, profile или email.

**Пример зпроса:**

```http request
POST http://localhost:8080/oauth2/token
Content-Type: application/x-www-form-urlencoded
 
client_id=web-service.ru&
client_secret=<client_secret>&
grant_type=password&
username=admin&
password=admin
```
###### * Хоть это и не определено спецификацией, но сервер авторизации примет запрос и в формате JSON (Content-Type: `application/json`) 

Если учётные данные и клиента и пользователя корректны, сервер авторизации вернёт маркер доступа для приложения.

#### Учётные данные клиента

* Тип разрешения на авторизацию с использованием учётных данных клиента позволяет приложению осуществлять доступ к своему собственному аккаунту сервиса. Это может быть полезно, например, когда приложение хочет обновить собственную регистрационную информацию на сервисе или URI перенаправления, или же осуществить доступ к другой информации, хранимой в аккаунте приложения на сервисе, через API.

**Параметры запроса:**

Поле | Значение | Описание
------------ | :------------: | ------------
client_id | `client_id` | **Обязательный**. Идентификатор клиента.
client_secret | `client_secret` | **Обязательный**. Секрет клиента.
grant_type | client_credentials | **Обязательный**. Как определено в [спецификации](https://tools.ietf.org/html/rfc6749#section-4.4.2) OAuth 2.0, это поле должно содержать значение client_credentials.
scope | `scope` | **Рекомендуемый**. Список областей, разделенных пробелами, которые определяют ресурсы, к которым ваше приложение может получить доступ от имени пользователя.

* Согласно [спецификации](https://tools.ietf.org/html/rfc6749#section-2.3.1) OAuth 2.0, параметры авторизации клиента (`client_id` и `client_secret`) могут быть переданы как в теле запроса так и в HTTP заголовке `Authorization` (HTTP Basic authentication).

```
Authorization: Basic d2ViLXNlcnZpY2UucnU6Y2xpZW50IHNlY3JldA==   
```

В ответ на запрос сервер авторизации, вернет объект JSON, который содержит маркер краткосрочного доступа и маркер обновления.

**Ответ содержит следующие поля:**

Поле | Тип | Описание
------------ | ------------ | ------------
access_token | STRING | Маркер доступа (сроком действия 1 день).
expires_in | INTEGER | Оставшееся время жизни маркера доступа в секундах.
token_type | STRING | Тип возвращаемого маркера. Значение всегда будет Bearer.
session | STRING | Идентификатор сессии пользователя.
refresh_token | STRING | Маркер который вы можете использовать для получения нового маркер доступа.
id_token | STRING | * Маркер пользователя.

* Обратите внимание, что маркер пользователя возвращается только в том случае, если ваше приложение в запросе к серверу авторизации, установило в `scope` одно из значений: openid, profile или email.

**Пример зпроса:**

```http request
POST http://localhost:8080/oauth2/token
Content-Type: application/x-www-form-urlencoded
 
client_id=web-service.ru&
client_secret=<client_secret>&
grant_type=client_credentials
```

### Обновление маркера доступа

* После истечения срока действия маркера доступа все запросы к API с его использованием будут возвращать ошибку с кодом `403` (&quot;Token expired&quot;). Если при создании маркера доступа был создан и маркер для обновления маркера доступа (`refresh_token`), последний может быть использован для получения нового маркера доступа от сервера авторизации.

**Параметры запроса:**

Поле | Значение | Описание
------------ | :------------: | ------------
client_id | `client_id` | **Обязательный**. Идентификатор клиента.
client_secret | `client_secret` | **Обязательный**. Секрет клиента.
grant_type | refresh_token | **Обязательный**. Как определено в [спецификации](https://tools.ietf.org/html/rfc6749#section-6) OAuth 2.0, это поле должно содержать значение refresh_token.
refresh_token | `refresh_token` | **Обязательный**. Маркер обновления, выданный ранее.
scope | `scope` | **Рекомендуемый**. Список областей, разделенных пробелами, которые определяют ресурсы, к которым ваше приложение может получить доступ от имени пользователя.

* Согласно [спецификации](https://tools.ietf.org/html/rfc6749#section-2.3.1) OAuth 2.0, параметры авторизации клиента (`client_id` и `client_secret`) могут быть переданы как в теле запроса так и в HTTP заголовке `Authorization` (HTTP Basic authentication).

```
Authorization: Basic d2ViLXNlcnZpY2UucnU6Y2xpZW50IHNlY3JldA==   
```

**Пример зпроса:**

```http request
POST http://localhost:8080/oauth2/token
Content-Type: application/x-www-form-urlencoded
 
client_id=web-service.ru&
client_secret=<client_secret>&
grant_type=refresh_token&
refresh_token=e%2FdtGmXCIzHvPMURn%2FTH9udTPxtKpR5FFifx2uvH1WqT4myXLtgyjkLgYDy7g3Ik5MrFRR82
```

###### * Хоть это и не определено спецификацией, но сервер авторизации примет запрос и в формате JSON (Content-Type: `application/json`) 

Если учётные данные клиента корректны, то сервер авторизации вернёт новый маркер краткосрочного доступа и новый маркер обновления.

## Платформа

### Общие параметры запроса для списка
* Для конечных точек возвращающих данные **ОБЪЕКТА** в виде списка `/list` применимо единное правило и следующее параметры:

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ | ------------
fields | JSON | Массив строк | Список полей. Если не указан, вернёт все доступные поля. 
search | JSON | Массив объектов | Условия для отбора данных. 
filter | JSON | Объект | Фильтр для отбора данных в виде пары ключ/значение. В качестве ключа указывается имя поля. `filter` является краткой формой `search`. 
reclimit | INTEGER | Число | Возвращает не больше заданного числа строк (может быть меньше, если сам запрос выдал меньшее количество строк).
recoffset | INTEGER | Число | Пропускает указанное число строк в запросе.
orderby | JSON | Массив строк | Порядок сортировки (список полей). Допустимо указание `ASC` и `DESC` (`name DESC`) 

**Расшифровка параметра `search`**:

Ключ | Тип | Обязательный | Описание
------------ | ------------ | ------------ | ------------
condition | STRING | НЕТ | Условие. Может принимать только два значения `AND` (по умолчанию) или `OR`. 
field | STRING | ДА | Наименование поля, к которому применяется условие. 
compare | STRING | НЕТ | Сравнение. Может принимать только одно из значений: (`EQL`, `NEQ`, `LSS`, `LEQ`, `GTR`, `GEQ`, `GIN`, `LKE`, `ISN`, `INN`).
value | STRING | ДА/НЕТ | Искомое значение. 
valarr | JSON | ДА/НЕТ | Искомые значения в виде массива. Если указан ключ `valarr`, то ключи `compare` и `value` игнорируются.

**Формат `compare`:**

Значение | Описание
------------ | ------------
EQL | Равно (по умолчанию). 
NEQ | Не равно. 
LSS | Меньше. 
LEQ | Меньше или равно. 
GTR | Больше. 
GEQ | Больше или равно. 
GIN | Для поиска вхождений JSON. 
LKE | LIKE - Значение ключа `value` должно передаваться вместе со знаком '%' в нужном месте;
ISN | Ключ `value` должен быть опушен (не указан). 
INN | Ключ `value` должен быть опушен (не указан). 

**Примеры:**

```http request
POST /api/v1/object/geolocation/list HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Basic YWRtaW46YWRtaW4=

{"filter": {"object": 2, "code": "default"}}
````

```http request
POST /api/v1/address/list HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Basic YWRtaW46YWRtaW4=

{"fields": ["description"], "search": [{"field": "apartment", "compare": "GEQ", "value": "5"}]}
````

```http request
POST /api/v1/admin/session/list HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Basic YWRtaW46YWRtaW4=

{"search": [{"field":"userid","compare":"EQL","value":"1004","condition":"OR", "lstr": "("},{"field":"userid","compare":"EQL","value":"1010","condition":"OR", "rstr": ")"},{"field":"created","compare":"LSS","value":"12.08.2020"},{"field":"created","compare":"GEQ","value":"11.08.2020"}]}
````

### Конечные точки

#### Тест подключения
```http request
GET /api/v1/ping
```
Проверить подключение к REST API.
 
**Параметры запроса:**
НЕТ
 
**Пример ответа:**
```json
{}
```
 
#### Проверить время сервера
```http request
GET /api/v1/time
```
Проверить подключение к REST API и получить текущее время сервера.
 
**Параметры запроса:**
 НЕТ
  
**Пример ответа:**
```json
{
  "serverTime": 1583495795455
}
```

### Регистрация

```http request
POST /api/v1/sign/up
```
Регистрация нового пользователя в системе.

* Для вызова метода необходимо предварительно получить разрешение на авторизацию [учётные данные клиента](#учётные-данные-клиента).

* Метод вызывается сервером авторизации при регистрации пользователя. 

**Параметры:**

Имя | Тип | Значение | Описание
------------ | ------------| ------------ |------------
type | STRING | entity, physical, individual | **Рекомендуемый**. Тип клиента. По умолчаию: physical. 
username | STRING | | **Обязательный**. Логин пользователя. 
password | STRING | | **Обязательный**. Пароль пользователя.
name | JSON object | | **Рекомендуемый**. Полное наименование компании/Ф.И.О. клиента (пользователя).
phone | STRING | | **Рекомендуемый**. Телефон.
email | STRING | | **Рекомендуемый**. Электронный адрес.
info | JSON  | | **Рекомендуемый**. Дополнительная информация.
description | STRING | | **Рекомендуемый**. Описание.

**Формат `name`:**

Ключ | Тип | Описание
------------ | ------------ | ------------
name | STRING | **Рекомендуемый**. Полное наименование организации/Ф.И.О одной строкой
short | STRING | **Рекомендуемый**. Краткое наименование организации
first | STRING | **Рекомендуемый**. Имя
last | STRING | **Рекомендуемый**. Фамилия
middle | STRING | **Рекомендуемый**. Отчество

Группы:
 - `<name>` `[<short>]`
 - `<first>` `<last>` `[<middle>]` `[<short>]`

**Формат `info`:** произвольный.

**Описание ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор созданного пользователя.
userid | NUMERIC | Идентификатор учётной записи пользователя.
  
**Пример:**

Запрос:
```http request
POST /api/v1/sign/up HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{"type":"physical","name":{"name":"User Name","short":"User Name","first":"User","last":"Name","middle":""},"phone":"","email":"mail@mail.ru"}
```

Ответ (положительный):
```json
{"id":2,"userid":1009}
``` 
 
Ответ (отрицательный):
```json
{"error": {"code": 400, "message": "Учётная запись с электронным адресом \"mail@mail.ru\" уже зарегистрирована."}}
``` 
 
### Вход в систему

```http request
POST /api/v1/sign/in
```
Вход в систему по предоставленным данным от пользователя.

* Обратите внимание, что наличие маркера доступа (пользователя) свидетельствует о том, что вход в систему уже был осуществлён.    

* Метод вызывается сервером авторизации при входе в систему. Вызов метода на прямую приведет к ошибке. 

* Для входа в систему используйте конечные точки сервера авторизации: [Учётные данные владельца ресурса](#учётные-данные-владельца-ресурса).

**Параметры:**

Поле | Тип | Описание
------------ | ------------ | ------------
username | STRING | **Вариативный**. Имя пользователя (Персональный код).
phone | STRING | **Вариативный**. Телефон.
email | STRING | **Вариативный**. Электронный адрес.
password | STRING | **Вариативный**. Пароль. Если `username` это персональный код, то  в `password` нужно передать хеш SHA1(`secret`) от секретного кода пользователя.
agent | STRING | **Игнорируется**. Агент пользователя (браузер). Значение проставляется системой.
host | STRING | **Игнорируется**. IP адрес. Значение проставляется системой.
  
**Варианты:**
 - `<username>` `<password>`
 - `<phone>` `<password>`
 - `<email>` `<password>`
  
**Описание ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
session | STRING | Код сессии.
code | STRING | Код авторизации для получения маркера доступа по протоколу OAuth 2.0.
secret | STRING | Секретный ключ (не путать с секретныйм кодом пользователя) для подписи методом HMAC-SHA256.
  
**Пример:**

Запрос:
```http request
POST /api/v1/sign/in HTTP/1.1
Host: localhost:8080
Content-Type: application/json

{"username": "user", "password": "user"}
```

Ответ (положительный):
```json
{
  "session":"149d2ae6fa3f82eda21f7dba21824f199d508343",
  "code":"0s4mI+o6tKbubsOirzgxl24/SVoWI8L3ruJYUz/J0+SjbnW12oF9kVe1B642Uw8P",
  "secret":"pkPm5zmHKj04Xr/NH1nKr6ZEUqOfyacC79HLFIQTrBgA6ApbgBvGiJlMBy4XBApt"
}
```

Ответ (отрицательный):
```json
{"error": {"code": 401, "message": "Вход в систему невозможен. Проверьте правильность имени пользователя и повторите ввод пароля."}}
```

#### Выход из системы

```http request
POST /api/v1/sign/out
```
Выйти из системы и закрыть сессию.

**Параметры запроса:**

Поле | Тип | Описание
------------ | ------------ | ------------
session | STRING | **Обязательный**. Сессия.
close_all | BOOLEAN | **Необязательный**. Закрыть все сессии.

#### Аутентификация

```http request
POST /api/v1/authenticate
```
Аутентифицировать пользователя по коду сессии и секретному коду (сессии).

**Параметры запроса:**

Поле | Тип | Описание
------------ | ------------ | ------------
session | STRING | **Обязательный**. Сессия.
secret | STRING | **Обязательный**. Секретный код.
agent | STRING | **Необязательный**. Агент.
host | STRING | **Необязательный**. IP адрес.

**Описание ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
code | STRING | Код авторизации для получения маркера доступа.

#### Авторизация

```http request
POST /api/v1/authorize
```
Авторизовать пользователя по коду сессии.

**Параметры запроса:**

Поле | Тип | Описание
------------ | ------------ | ------------
session | STRING | **Обязательный**. Сессия.

**Описание ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
authorized | BOOLEAN | Результат авторизации.
message | STRING | Сообщение.

#### Кто я?
```http request
POST /api/v1/whoami
```
Информация об авторизованном пользователе.

**Параметры запроса:**
 НЕТ

**Описание ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор клиента. Может быть null если учётная запись пользователя не связана с клиентом (например вход произведён от имени администратора системы).
userid | NUMERIC | Идентификатор учётной записи пользователя.
suid | NUMERIC | Идентификатор учётной записи системного пользователя.
admin | BOOLEAN | Признак прав доступа на уровне администратора системы.
profile | JSON | Профиль пользователя (учётной записи).
name | JSON | Наименование клиента.
email | JSON | Справочник электронных адресов клиента.
phone | JSON | Телефонный справочник клиента.
session | JSON | Сессия.
locale | JSON | Локаль.
area | JSON | Зона.
interface | JSON | Интерфейс.

**Описание `profile`:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор учётной записи.
username | STRING | Логин.
name | STRING | Полное наименование.
family_name | STRING | Фамилия.
given_name | STRING | Имя.
patronymic_name | STRING | Отчество.
email | STRING | Электронный адрес для входа в систему.
email_verified | BOOLEAN | Электронный адрес подтверждён.
phone | STRING | Телефон для входа в систему.
phone_verified | BOOLEAN | Телефон подтверждён.
session_limit | INTEGER | Максимально допустимое количество одновременно открытых сессий.
created | TIMESTAMP | Создан.
locale | STRING | Код локали по умолчанию.
area | STRING | Код зоны (подразделения) по умолчанию.
interface | STRING | Код интерфейса (рабочего места) по умолчанию.
description | STRING | Описание пользователя.
picture | STRING | URL на логотип.
passwordchange | BOOLEAN | Сменить пароль при следующем входе в систему (да/нет).
passwordnotchange | BOOLEAN | Установлен запрет на смену пароля самим пользователем (да/нет).
system | BOOLEAN | Системный пользователь (пользователь СУБД).
status | STRING | Статус пользователя.
state | STRING | Состояние пользователя.
lock_date | TIMESTAMP | Дата блокировки пользователя.
expiry_date | TIMESTAMP | Дата окончания срока действия пароля.
lc_ip | STRING | IP адрес последнего подключения.
input_count | NUMERIC | Счетчик входов.
input_last | TIMESTAMP | Последний вход.
input_error | NUMERIC | Текущие неудавшиеся входы.
input_error_last | TIMESTAMP | Последний неудавшийся вход в систему.
input_error_all | NUMERIC | Общее количество неудачных входов.
  
**Пример ответа:**
```json
{
  "id": 14,
  "userid": 1012,
  "suid": 1012,
  "admin": false,
  "profile": {
    "id": 1012,
    "username": "user",
    "name": "Пользователь",
    "given_name": null,
    "family_name": null,
    "patronymic_name": null,
    "email": null,
    "email_verified": false,
    "phone": null,
    "phone_verified": false,
    "session_limit": 0,
    "created": "2020-08-05T21:14:18.446581",
    "locale": "ru",
    "area": "default",
    "interface": "I:1:0:0",
    "description": "Пользователь",
    "picture": null,
    "passwordchange": true,
    "passwordnotchange": false,
    "system": "no",
    "status": "active",
    "state": "offline",
    "lock_date": null,
    "expiry_date": null,
    "lc_ip": "127.0.0.1",
    "input_count": 8,
    "input_last": "2020-08-07T15:16:11.939721",
    "input_error": 0,
    "input_error_last": null,
    "input_error_all": 0
  },
  "name": {
    "name": "Пользователь",
    "short": null,
    "first": null,
    "last": null,
    "middle": null
  },
  "email": null,
  "phone": null,
  "session": {
    "code": "4a9adbb079b49aeb7269bbc69c845914cc12127c",
    "created": "2020-08-07T15:16:11.939721",
    "updated": "2020-08-07T15:16:17.028765",
    "agent": "Mozilla/5.0 (X11;Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) advanced-rest-client/14.0.1 Chrome/76.0.3809.146 Electron/6.1.1 Safari/537.36",
    "host": "127.0.0.1"
  },
  "locale": {
    "id": 100000000000,
    "code": "ru",
    "name": "Русский",
    "description": "Русский язык"
  },
  "area": {
    "id": 100000000012,
    "parent": 100000000011,
    "type": 100000000003,
    "code": "default",
    "name": "По умолчанию",
    "description": null,
    "validfromdate": "2020-08-05T20:49:17.092729",
    "validtodate": null
  },
  "interface": {
    "id": 100000000007,
    "sid": "I:1:0:0",
    "name": "Все",
    "description": "Интерфейс для всех"
  }
}
```

### Локализация

#### Список локализаций
```http request
POST /api/v1/locale
```
Получить список доступных локализаций.

**Параметры запроса:**
 НЕТ
  
#### Текущая локализация
```http request
POST /api/v1/current/locale
```
Получить идентификатор выбранного (текущего) языка.

**Параметры запроса:**
 НЕТ
  
#### Установить локаль
```http request
POST /api/v1/locale/set
```
Установить локаль. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | Идентификатор
code | STRING | en, ru | Код

Группы:
 - `<id>`
 - `<code>`

#### Сущности
```http request
POST /api/v1/essence
```
Получить список сущностей.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Классы
```http request
POST /api/v1/class
```
Получить список (дерево) классов объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Действия
```http request
POST /api/v1/action
```
Получить список действий.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Выполнить действие
```http request
POST /api/v1/action/run
```
Выполняет действие над объектом.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
action | NUMERIC |  | **Обязательный**. Идентификатор действия.
form | JSON |  | **Необязательный**. Параметры HTML формы в формате JSON.

#### Типы состояний
```http request
POST /api/v1/state/type
```
Получить список типов состояний объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Состояния
```http request
POST /api/v1/state
```
Получить список состояний объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Типы объекта
```http request
POST /api/v1/type
```
Получить список типов объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Метод

##### Выполнить
```http request
POST /api/v1/method/run
```
Выполняет динамический метод объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
method | NUMERIC |  | **Обязательный**. Идентификатор метода.
form | JSON |  | **Необязательный**. Параметры HTML формы в формате JSON.

##### Получить

```http request
POST /api/v1/method/get
```
Запросить информацию о методе документооборота.

**Обязателен** как минимум один из параметров указанный в теле запроса:

Имя | Тип | Описание
------------ | ------------ | ------------
object | NUMERIC | Идентификатор объекта
class | NUMERIC | Идентификатор класса
state | NUMERIC | Идентификатор состояния
classcode | STRING | Код класса (вместо идентификатора)
statecode | STRING | Код состояния (вместо идентификатора)

**Пример:**

Запрос:
```http request
POST /api/v1/method/get HTTP/1.1
Host: localhost:8080
Content-Type: application/x-www-form-urlencoded
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

classcode=client&statecode=enabled
```

Ответ:
```json
[
  {"id":100000000211,"parent":null,"action":100000000053,"actioncode":"disable","label":"Закрыть","visible":true},
  {"id":100000000212,"parent":null,"action":100000000054,"actioncode":"delete","label":"Удалить","visible":true}
]
```

##### Список

```http request
POST /api/v1/method/list
```
Предоставит список всех доступных методов. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Журнал событий
```http request
POST /api/v1/event/log
```
Выводит журнал событий.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
type | CHAR | M, W, E | **Необязательный**. Тип события.
code | INTEGER |  | **Необязательный**. Код.
datefrom | TIMESTAMP |  | **Необязательный**. Дата начала периода.
dateto | TIMESTAMP |  | **Необязательный**. Дата окончания периода.

##### Установить
```http request
POST /api/v1/event/log/set
```
Добавляет запись в журнал событий.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
type | CHAR | M, W, E | **Необязательный**. Тип события.
code | INTEGER |  | **Необязательный**. Код.
text | STRING |  | **Необязательный**. Текст.

##### Получить
```http request
POST /api/v1/event/log/get
```
Возвращает запись в журнале событий.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор записи.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

##### Список
```http request
POST /api/v1/event/log/list
```
Возвращает записи из журнала событий. 

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

#### Текущие значения
```http request
POST /api/v1/current/<param>
```
Получить информацию о текущих значениях.

Где `<param>`:

- `session` (сессия);
- `user` (пользователь);
- `userid` (идентификатор пользователя);
- `username` (login пользователя);
- `area` (зона);
- `interface` (интерфейс);
- `locale` (язык);
- `oper_date` (дата операционного дня).
 
**Параметры запроса:**
 НЕТ
  
#### Сессия
```http request
POST /api/v1/session/set/<param>
```
Установить параметры текущей сессии.

Где `<param>`:

- `area` (зона);
- `interface` (интерфейс);
- `locale` (язык);
- `oper_date` (дата операционного дня).

**Параметры для (`area`, `interface`, `locale`):**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор. Имеет приоритет над кодом.
code | STRING |  | **Обязательный**. Код.

**Параметры для (`oper_date`):**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
oper_date | TIMESTAMP |  | **Обязательный**. Переведёт систему в режим работы с архивной датой. Значение null вернет систему в нормальный режим.
 
**Параметры запроса:**
 НЕТ

#### Объект

##### Класс объекта
```http request
POST /api/v1/object/class
```
Возвращает класс объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.

##### Тип объекта
```http request
POST /api/v1/object/type
```
Возвращает тип объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

##### Состояние объекта
```http request
POST /api/v1/object/state
```
Возвращает состояние объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

##### Удалить объект
```http request
POST /api/v1/object/force/delete
```
Принудительно "удаляет" документ (минуя события документооборота).

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.

#### Файлы объекта
```http request
POST /api/v1/object/file
```
Получить или установить связь объекта с файлом на сервере или содержимое файла. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
files | JSON array | null OR json | **Вариативный**. Массив JSON объектов с описанием файлов.

**Формат `files`:**

Ключ | Тип | Описание
------------ | ------------ | ------------
name | STRING | **Обязательный**. Наименование файла на сервере (включая путь).
path | STRING | **Необязательный**. Только путь к файлу (на сервере).
size | INTEGER | **Необязательный**. Размер файла (осторожнее с null или 0).
date | TIMESTAMP | **Необязательный**. Дата и время файла.
data | STRING | **Необязательный**. Содержимое файла (если нужно) в формате BASE64.
hash | STRING | **Необязательный**. Хеш файла.

**ВНИМАНИЕ**: Если значение `files` не указано или равно `null`, то метод работает как `Получить` иначе как `Установить`.

##### Установить
```http request
POST /api/v1/object/files/set
```
Установить связь объекта с файлом на сервере. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
files | JSON array | | **Обязательный**. Массив JSON объектов с описанием файлов.
  
**ВНИМАНИЕ**: Значения не указанных ключей считаются как `null`.

**ВНИМАНИЕ**: Если значение ключа `size` не указано или равно нулю, то действие считается как `Удалить`.   

##### Получить
```http request
POST /api/v1/object/files/get
```
Получить связь объекта с файлом на сервере. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
name | STRING |  | **Обязательный**. Наименование файла на сервере (включая путь).
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

##### Список
```http request
POST /api/v1/object/files/list
```
Получить связи объекта с файлами на сервере в виде списка. 

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

#### Данные объекта
```http request
POST /api/v1/object/data
```
Получить или установить произвольные данные для объекта. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
data | JSON array | null OR json | **Вариативный**. Массив JSON объектов с произвольными данными.

**Формат `data`:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
type | STRING | text, json, xml | **Обязательный**. Код типа произвольных данных объекта. 
code | STRING | | **Обязательный**. Код произвольных данных.
data | STRING | | **Вариативный**. Произвольные данные.

**ВНИМАНИЕ**: Если значение `data` не указано или равно `null`, то метод работает как `Получить` иначе как `Установить`.

##### Установить
```http request
POST /api/v1/object/data/set
```
Установить произвольные данные для объекта. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
data | JSON array |  | **Обязательный**. Массив JSON объектов с произвольными данными.
  
**ВНИМАНИЕ**: Значения не указанных ключей считаются как `null`.

**ВНИМАНИЕ**: Если значение ключа `data` не указано или равно `null`, то действие считается как `Удалить`.   

##### Получить
```http request
POST /api/v1/object/data/get
```
Получить произвольные данные для объекта. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
type | NUMERIC |  | **Вариативный**. Идентификатор типа произвольных данных объекта. 
typecode | STRING | text, json, xml | **Вариативный**. Код типа произвольных данных объекта. 
code | STRING | | **Обязательный**. Код произвольных данных.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

##### Список
```http request
POST /api/v1/object/data/list
```
Получить произвольные данные для объекта в виде списка. 

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

#### Геолокация объекта
```http request
POST /api/v1/object/geolocation
```
Получить или установить координаты геолокации для объекта. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
coordinates | JSON array | null OR json | **Вариативный**. Массив JSON объектов с координатами.

**Формат `coordinates`:**

Ключ | Тип | Описание
------------ | ------------ | ------------
code | STRING | **Необязательный**. Код.
latitude | NUMERIC | **Обязательный**. Широта.
longitude | NUMERIC | **Обязательный**. Долгота.
accuracy | NUMERIC | **Необязательный**. Точность (высота над уровнем моря).
label | STRING | **Необязательный**. Метка.
description | STRING | **Необязательный**. Описание.

**ВНИМАНИЕ**: Если значение `coordinates` не указано или равно `null`, то метод работает как `Получить` иначе как `Установить`.

##### Установить
```http request
POST /api/v1/object/geolocation/set
```
Установить координаты геолокации для объекта. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
coordinates | JSON array |  | **Обязательный**. Массив JSON объектов с координатами.
  
**ВНИМАНИЕ**: Координаты геолокации для объекта хранятся в виде истории по дате и времени добавления.   

##### Получить
```http request
POST /api/v1/object/geolocation/get
```
Получить последние координаты геолокации для объекта. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

**ВНИМАНИЕ**: На период может повлиять значение `oper_date` (дата операционного дня) см. [Текущие значения](#текущие-значения).   

##### Список
```http request
POST /api/v1/object/geolocation/list
```
Получить координаты геолокации в виде списка. 

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

#### Адрес объекта
```http request
POST /api/v1/object/address
```
Получить или установить почтовый адрес объекта. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
addresses | JSON array | null OR json | **Вариативный**. Массив JSON объектов с адресами.

**Формат `addresses`:**

Ключ | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | **Вариативный**. Идентификатор адреса.
parent | NUMERIC | **Необязательный**. Идентификатор родителя.
type | STRING | **Необязательный**. Код типа адреса.
code | STRING | **Обязательный** если иные ключи не указаны. Код: ФФ СС РРР ГГГ ППП УУУУ. Где: ФФ - код страны; СС - код субъекта РФ; РРР - код района; ГГГ - код города; ППП - код населенного пункта; УУУУ - код улицы.
index | STRING | **Необязательный**. Почтовый индекс.
country | STRING | **Необязательный**. Страна.
region | STRING | **Необязательный**. Регион.
district | STRING | **Необязательный**. Район.
city | STRING | **Необязательный**. Город.
settlement | STRING | **Необязательный**. Населённый пункт.
street | STRING | **Необязательный**. Улица.
house | STRING | **Необязательный**. Дом.
building | STRING | **Необязательный**. Корпус.
structure | STRING | **Необязательный**. Строение.
apartment | STRING | **Необязательный**. Квартира.
address | STRING | **Необязательный**. Полный адрес.

**ВНИМАНИЕ**: Если значение `id` не указано или равно `null`, то будет создан новый почтовый адрес, иначе изменён.   

**ВНИМАНИЕ**: Если значение `addresses` не указано или равно `null`, то метод работает как `Получить` иначе как `Установить`.

##### Установить
```http request
POST /api/v1/object/address/set
```
Связывает ранее созданный почтовый адрес с объектом. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
address | JSON array |  | **Обязательный**. Идентификатор адреса.  
datefrom | TIMESTAMP |  | **Необязательный**. Дата начала периода.

##### Получить
```http request
POST /api/v1/object/address/get
```
Получить почтовый адрес объекта. 

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

##### Список
```http request
POST /api/v1/object/address/list
```
Получить координаты геолокации в виде списка. 

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

#### КЛАДР

* Классификатор адресов Российской Федерации (КЛАДР) — ведомственный классификатор ФНС России, созданный для распределения территорий между налоговыми инспекциями и автоматизированной рассылки корреспонденции.

В систему, для удобства создания почтовых адресов (сущность `address`), интегрирован справочник КЛАДР. Реализован он в виде дерева адресов. Глубина реализации: до улиц. 

##### Получить
```http request
POST /api/v1/address/tree/get
```
Возвращает адрес из справочника адресов КЛАДР.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор справочника.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.
 
##### Список
```http request
POST /api/v1/address/tree/list
```
Возвращает справачник адресов КЛАДР в виде списка. 

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

##### История
```http request
POST /api/v1/address/tree/history
```
Возвращает историю из справочника адресов КЛАДР.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Вариативный**. Идентификатор справочника. Имеет приоритет над `code`.
code | STRING |  | **Вариативный**. Код из справочника адресов: ФФ СС РРР ГГГ ППП УУУУ.

**Описание `code`:**

|  ФФ   |   СС   |   РРР   |   ГГГ   |    ППП   |    УУУУ   | 
| :---: | :----: | :-----: | :-----: | :------: |  :------: |
| Код страны | Код субъекта РФ | Код района | Код города | Код населенного пункта | Код улицы |

##### Строка
```http request
POST /api/v1/address/tree/string
```
Возвращает адрес из справочника адресов КЛАДР в виде строки.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
code | STRING |  | **Обязательный**. Код из справочника адресов: ФФ СС РРР ГГГ ППП УУУУ.
short | INTEGER |  | **Необязательный**. Сокращение: 0 - нет; 1 - слева; 2 - справа.
level | INTEGER |  | **Необязательный**. Ограничение уровня вложенности.

## Конфигурация

### Конечные точки

#### Общие конечные точки

* Для всех _объектов_ имеются общие конечные точки:

###### Описание конечных точек сущностей [здесь](#конечные-точки-сущностей).  

```http request
POST /api/v1/<essence>/<action>
```

Где `<essence>` - это не абстрактная сущность смотрим на [дерево классов объекта](#дерево-классов-объекта) или выполняем [запрос](#сущности).

Где `<action>` (действие):
- `type` (тип);
- `method` (метод);
- `count` (количество);
- `set` (установить - добавить или изменить);
- `get` (получить);
- `list` (список);

##### Действие тип
```http request
POST /api/v1/<essence>/type
```
Информация о типе объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

##### Действие метод
```http request
POST /api/v1/<essence>/method
```
Информация о методах объекта.

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.

##### Действие количество
```http request
POST /api/v1/<essence>/count
```
Количество объектов с возможностью указания фильтра отбора данных.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

##### Действие установить
```http request
POST /api/v1/<essence>/set
```
Установить данные объекта.

[Параметры](#параметры-запросов)

**ВНИМАНИЕ**: Если значение ключа `id` не указано или равно `null`, то действие считается как _добавить_, иначе как _изменить_.   

**ВНИМАНИЕ**: Значения не указанных ключей считаются как `null`.

**ВНИМАНИЕ**: Для действия _изменить_ не нужно передавать значения всех ключей, достаточно передать только те, которые требуется поменять.   

**ВНИМАНИЕ**: Ответом на запрос будут данные действия [_получить_](#действие-получить).   

##### Действие получить
```http request
POST /api/v1/<essence>/get
```
Получить данные объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

**ВНИМАНИЕ**: Формат данных в ответе уникален для каждой сущности и подробно описан в разделе [класс-таблицы](#класс-таблицы).    

##### Действие список
```http request
POST /api/v1/<essence>/list
```
Получить данные объекта в виде списка с возможностью указания фильтра отбора.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

### Конечные точки сущностей

#### Адрес (`address`)

#### Общие
```http request
POST /api/v1/address/[ type | method | count | set | get | list ]
```
[Общие конечные точки](#общие-конечные-точки)

##### Адрес в виде строки
```http request
POST /api/v1/address/get/string
```
Возвращает адрес в виде строки.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.

#### Клиент (`client`)

#### Общие
```http request
POST /api/v1/client/[ type | method | count | set | get | list ]
```
[Общие конечные точки](#общие-конечные-точки)

### Параметры запросов

* Параметры запросов для действие [_установить_](#действие-установить).

#### Клиент (`client`)

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный** для действия _изменить_. Идентификатор объекта.
parent | NUMERIC |  | **Необязательный**. Идентификатор объекта родителя.
type | STRING |  | **Необязательный**. Код типа.
code | STRING |  | **Рекомендуемый**. ИНН - для юридического лица или имя пользователя (login).
userid | NUMERIC |  | **Необязательный**. Идентификатор учётной записи клиента. Если указать 0, то учётная запись будет создана автоматически.
name | JSON |  | **Рекомендуемый**. Наименование компании/Ф.И.О.
phone | JSON |  | **Необязательный**. Справочник телефонов.
email | JSON |  | **Необязательный**. Электронные адреса.
info | JSON |  | **Необязательный**. Дополнительная информация.
description | STRING |  | **Необязательный**. Описание.

**Формат `name`:**

Ключ | Тип | Описание
------------ | ------------ | ------------
name | STRING | **Рекомендуемый**. Полное наименование организации/Ф.И.О одной строкой
short | STRING | **Рекомендуемый**. Краткое наименование организации
first | STRING | **Рекомендуемый**. Имя
last | STRING | **Рекомендуемый**. Фамилия
middle | STRING | **Рекомендуемый**. Отчество

**Формат `phone`:** произвольный.
**Формат `email`:** произвольный.
**Формат `info`:** произвольный.

### Данные объекта
* Данные объекта хранятся в _класс-таблицах_. Конечный набор данных для каждого объекта формируется путём добавления друг к другу всех полей из всех _класс-таблиц_.

Какие именно _класс-таблицы_ участвуют в формировании набора данных можно посмотреть в [дереве классов объекта](#дерево-классов-объекта).

### Класс таблицы

#### Объект (`object`)

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор объекта.
parent | NUMERIC | Идентификатор родителя объекта.
essence | NUMERIC | Идентификатор сущности.
essencecode | STRING | Код сущности.
class | NUMERIC | Идентификатор класса.
classcode | STRING | Код класса.
classlabel | STRING | Метка класса.
type | NUMERIC | Идентификатор типа.
typecode | STRING | Код типа.
typename | STRING | Наименование типа.
typedescription | STRING | Описание типа.
label | STRING | Метка.
statetype | NUMERIC | Тип состояния.
statetypecode | STRING | Код типа состояния.
statetypename | STRING | Наименование типа состояния.
state | NUMERIC | Состояние.
statecode | STRING | Код состояния.
statelabel | STRING | Метка состояния.
lastupdate | TIMESTAMP | Дата последнего изменения.
owner | NUMERIC | Идентификатор учётной записи владельца.
ownercode | STRING | Код (логин) учётной записи владельца.
ownername | STRING | Наименование учётной записи владельца.
created | TIMESTAMP | Физическая дата (дата создания).
oper | NUMERIC | Идентификатор учётной записи оператора.
opercode | STRING | Код (логин) учётной записи оператора.
opername | STRING | Наименование учётной записи оператора.
operdate | TIMESTAMP | Логическая дата (дата операции).

#### Документ (`document`)

Поле | Тип | Описание
------------ | ------------ | ------------
area | NUMERIC | Идентификатор зоны видимости объекта.
areacode | STRING | Код зоны видимости объекта.
areaname | STRING | Наименование зоны видимости объекта.
description | STRING | Описание.

#### Справочник (`reference`)

Поле | Тип | Описание
------------ | ------------ | ------------
code | STRING | Код.
name | STRING | Наименование.
description | STRING | Описание.

#### Адрес (`address`)

Поле | Тип | Описание
------------ | ------------ | ------------
code | STRING | Код КЛАДР (ФФ СС РРР ГГГ ППП УУУУ). 
index | STRING | Почтовый индекс.
country | STRING | Страна.
region | STRING | Регион.
district | STRING | Район.
city | STRING | Город.
settlement | STRING | Населённый пункт.
street | STRING | Улица.
house | STRING | Дом.
building | STRING | Корпус.
structure | STRING | Строение.
apartment | STRING | Квартира.
address | STRING | Полный адрес.

**Описание `code`:**

|  ФФ   |   СС   |   РРР   |   ГГГ   |    ППП   |    УУУУ   | 
| :---: | :----: | :-----: | :-----: | :------: |  :------: |
| Код страны | Код субъекта РФ | Код района | Код города | Код населенного пункта | Код улицы |

#### Клиент (`client`)

Поле | Тип | Описание
------------ | ------------ | ------------
code | STRING | Код клиента.
userId | NUMERIC | Идентификатор учётной записи клиента.
fullname | STRING | Полное наименование компании/Ф.И.О..
shortname | STRING | Краткое наименование компании.
lastname | STRING | Фамилия.
firstname | STRING | Имя.
middlename | STRING | Отчество.
birthday | TIMESTAMP | День рождения.
phone | JSON | Справочник телефонов.
email | JSON | Электронные адреса.
info | JSON | Дополнительная информация.
locale | NUMERIC | Идентификатор локали.
localecode | STRING | Код локали.
localename | STRING | Наименование локали.
